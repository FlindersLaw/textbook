---
title: An Introduction to Coding Concepts
---
import * as Constants from '@site/src/constants';
import * as Components from '@site/src/components';
// Import these directly as we use it a lot and makes the syntax a little cleaner
import {DisplayChapter} from '@site/src/components/DisplayChapter';
import {DisplayGlossaryItem} from '@site/src/components/DisplayGlossaryItem';

In <DisplayChapter chapter='chapter_2' /> , we learned
that <DisplayGlossaryItem item='questionblock' plural /> have two
main purposes. First, they collect input from a user by asking questions. Second, they can display those answers back to the user, either on the screen or by generating a document such as a PDF or Word file.

That's all well and good, but we need to be able to make decisions based on the input that we get from our users. That way, we can make decisions using that input, and display different output. For our app to make these decisions, we need 
to use <DisplayGlossaryItem item='codeblock' plural />.

In this section, we are going to introduce you to coding using Docassemble. You can write code in Docassemble code blocks
using <DisplayGlossaryItem item='python' upper />. Python is a 
programming language, and a very powerful one at that. A lot of what we can do in Python is beyond the scope of this course. All we're going to do is take a bit of Python and use it to do some powerful things. Let's start by looking
at <DisplayGlossaryItem item='variable' plural />.


## Variables
To acheive, this, we are going to
use <DisplayGlossaryItem item='variable' plural />. We've
been working with variables already
in <DisplayChapter chapter='chapter_2' nourl />,
without even knowing what to call them. A variable is where you store information. It's called a 'variable' because you can store different stuff in there each time the program runs. We have already seen how you can use different variables.

<DisplayImage imageURL='/img/textbook/chapter_3/variable_example1.PNG' />

For example,
in <DisplayChapter chapter='chapter_2' nourl /> we
used the variable `MJFfirstname` as a place to store the first name. Each time we run the program, we can store a new value in this variable. 

In Python, what we are doing is assigning a **value** to the variable. Values get assigned to variables. In addition to assigning variables via question blocks, we can also assign values to variables in code blocks. We can do that with a single equals sign (`=`). You can see how this is done below. 

:::tip TODO
Suggest the example goes here
:::

Note that what we are doing here is combining `MJFfirstname` and `MJFlastname` together to create `MFJname`. We have also added in a space, which creates a gap between the first name and last name. If you want to assign a text value to a variable, you must enclose it in quotes. Python treats anything in quotes as text, or what we call a string. 

## Datatypes

In the previous chapter, we encountered several variable datatypes, including `integer`, `currency` and `checkboxes`. Python has a set of datatypes which underpin Docassemble datatypes. Let's compare these datatypes:

| Docassemble Datatype | Python Datatype | Example |
| -------------------- | --------------- | ------- |
| `text`/`string`      | `string`        | 'John Smith' |
| `currency`           | `float`         | $55,000.00 |
| `integer`            | `int`           | 33      |
| Boolean              | boolean         | True/False |

The first datatype - text - is called a 'string' in Python. When we refer to strings from now on in this textbook we are referring to text. You will see this term a lot in coding. 

The second datatype - currency - is represented with what is called a floating point number or 'float'. A 'float' is the datatype for any number which is not a whole number, or has a decimal point. Fractions are always converted into decimals in Python.

By contrast, the third datatype - integers - have no decimal points. They can only be positive or negative whole numbers.

The final datatype is a new one - Boolean. A Boolean datatype can only ever be one of two values. True or False. This might seem a bit trivial, but Booleans are really important in programming. Many (if not all) of the questions that you present in your app can be reduce to a True or False proposition. We will see this a lot very soon.

## Logic and Coding 
This last datatype dovetails nicely into Logic. 

As mentioned previously, most of your apps will be analysing True or False propositions. For example:
* Are you an adult?
* Is your income within this range?
* Do you have this disability?
* Are you a resident of Australia?

In order to do this, we will need logical tests to assess whether something is True or False. Docassemble can rely on several types of logical tests, as seen in the table below:

| Test | Means this |
| ---- | ---------- |
| `==`   | equals to  |
| `!=`   | is not equal to |
| `<`    | less than  |
| `<=`   | less than or equal to |
| `>`    | greater than |
| `>=`   | greater than or equal to |

The left side of this test indicates how we might write out the test in code. Let's take an example. In human readable text, we might write the following:

'The income threshold for legal aid is $80,000 or less'.

We would write this in code as follows:

```LegalAidIncome <= 80000```

Now let's consider some slightly more advanced logic operators.

| Test | Means This |
| ---- | ---------- |
| `A == B` | A equals B |
| `A != B` | A does not equal B |
| `A >= B` | A is the same or bigger than B |
| `A <= C <= B` | C is between B and A |

One thing to note here is the equality test, which is represented by `==`. Note that this equality test is different from assignment, which is `=`. **Do not confuse these**. If you make a mistake, Python will not always raise an error message. Always check you have the right number of equal signs depending on what you intend to do. This should be the first step when looking for errors in your app, or **debugging**. 

We can also combine logical operators together using `and`, `or` and `not` statements.

| Test | Means This |
| ---- | ---------- |
| `A and B` | A and B are both true |
| `A or B` | Either A or B is true |
| `(A and B) or C` | Both A and B are true, or C is true |
| `A and not B` | A is true and B is not true |

These statements can be a very powerful way to express legislation in code. Let's consider an example. Say we wanted to examine the criteria to stand as a candidate for Federal Parliament in Australia. There are a few restrictions:
* A candidate cannot be a member of a state or territory Parliament; and
* A candidate cannot be a foreign national (including a dual citizen)

We could represent a test for whether a candidate is eligible to stand using the following test:

```not foreignNat and (not stateRep and not territoryRep) ```

## Code Blocks
How are we going to use all of this in practice? There are three ways:

1. We can embed logic in our question blocks using `%` tags. You might recall we did this in Chapter Two:

```
  % if MJFisemployed == 'Yes':
  Your annual income    | ${ currency(MJFannualincome) }
  % endif 
```
2. We can use code blocks. A code block is similar to a question block in that it must appear between three dashes. It's also a block that Docassemble checks when it tries to satisfy a variable. The difference between a code block and a question block is that a code block contains Python code, as shown below:

<DisplayImage imageURL='/img/textbook/chapter_3/codeblock_example1.PNG' />

3. We can embed code into Mako fields. Although you *can* do it, we do not cover it in too much detail in this textbook.

## If Statements
As you can see from the example above, to implement our decision making we use if statements.

The structure of an if statement is pretty simple. If a test is true, then do something: 

```
if condition == True:
    doSomething
```
We can also have an if statement that does something if a test is not true by using `else` (and it's good practice to have an else statement). 

```
if condition == True:
    doSomething
else:
    doSomethingElse
```

In addition, we can test for multiple conditions in Python using an `elif` statement. 
```
if condition_one == True:
    do_thing_one
elif condition_two == True:
    do_thing_two
else:
    do_thing_three
```

For example, returning to our previous example, you might want to test if someone is an Australian citizen, a permanent resident or is visiting on a visa. Using an if statement with two elifs is a good way to test this. We can then do a different thing on each branch. 

One thing to note here are the spaces between the `if` and `elif` statements versus the tests, as well as the colon at the end of each line. It is important you get this right, otherwise Docassemble will throw an error. 

As discussed previously, you should also *always* end your if block with an else statement. The reason for that is the else statement will capture anything not caught by our if statements. This practice will also force you to consider all of the different branches of your if statement. 

## An If Statement Example
The code below is for an app called 'Immigration Alert'. It's designed to alert the department of immigration when someone isn't an Australian citizen.

```yaml title="C2_01_immigration_alert.yml" showLineNumbers
---
# A program to alert Immigration if a non-citizen is using the computer
mandatory: True 
question: Immigration Alert
subquestion: |
  Your Ozzie status is **${ MJFis_an_ozzie }**

  %if MJFis_an_ozzie != 'Yes':
  The Immigration alert status is **${ MJFalert_immigration }**
  %endif
buttons:
  - Exit: exit
  - Restart: restart
---
# This code block contains the logic that determines
# whether we are all good from a citizenship point of view.
code: |
  if MJFis_citizen == 'Yes':
    MJFis_an_ozzie = True
  else:
    MJFis_an_ozzie = False
    MJFalert_immigration = True
---
question: Citizenship Status
fields:
  - Are you an Australian citizen?: MJFis_citizen
    datatype: radio
    choices:
      - Yes
      - No
---
```

The if statement on line 18 tests a variable called `MJFis_citizen`. That variable is populated by asking the question in the block starting on line 23.

If `MJFis_citizen` is equal to Yes, then the if statement sets another variable called `MJFis_an_ozzie` to contain the Boolean variable `True`. That is, the code block **assigns** the Boolean value True to `MJFis_an_ozzie`. If `MJFis_citizen` is set to No, the else block will be executed. That means `MJFis_an_ozzie` will be set to False and `MJFalert_immigration` will be set to True. 

Again, note the use of spacing, indentation and colons in this example. All of this must be correct for Python code to run correctly. Spacing, colons and equal signs should be the first things you check when you run your code. 

## Embedded If Statements 
In addition to if statements in code blocks, you can also embed if statements into your question blocks.We can see how to do this in lines 8 to 10 of `C2_01_immigration_alert.yml`. Embedding an if statement into your output is a very useful way of controlling what gets displayed. When you embed an if statement into a subquestion, you must do three things differently from a code if statement:

1. You must start the line with a %
2. At the end of your if statement, you must add in an `%endif`
3. You must not indent these if statements like you would in a code if statement. 

## More complex if statements 
Let's go back to our `and`, `or` and `not` statements. Remember that we can test for more than one thing at a time. We can demonstrate this by way of an example.

```yaml title="C2_02_age_eligibility.yml" showLineNumbers
# Example code to demonstrate how if statements operate
---
mandatory: True 
question: Age eligibility
subquestion: |
  Your age eligibility is **${ MJFage_ok }**
buttons:
  - Exit: exit
  - Restart: restart
---
code: |
  if ( (MJFage >= 18) and
       (MJFage < 65) ):
    MJFage_ok = True
  else:
    MJFage_ok = False
---
question: What is your age?
fields:
  - no label: MJFage
    datatype: integer
---
```

In the code block that begins on line 11, you can see that we are testing for the truth of two criteria.

1. MJFage must be greater than or equal to 18
2. MJFage must be less than 65

The entire test is enclosed in parentheses, as are each of the sub-tests. This isn't necessary, but it's good practice and it saves on confusion as your if statements will get complicated.

## Execution Order
Now, how will Docassemble execute this program?

1. It will find the `mandatory` block at line 3 and start processing that.
2. To display this mandatory block, it will need a value for `MJFage_ok` (which is displayed at line 6).
3. It then searches for the code block which starts at line 11.
4. It tries to execute that code block, buit finds it needs a value for `MJFage`
5. It looks for a question block that sets `MJFage`, which it finds at line 18
6. Docassemble first asks that question, and then executes the code block, using `MJFage` to evaluate the if statement. The output of MJFage_ok is then shown in the mandatory block.

If you run through this code, and then click on the little `<\>` icon in the top left hand corner of the screen, you can see this execution order:

<DisplayImage imageURL='/img/textbook/chapter_3/show_execution_order1.PNG' />

<DisplayImage imageURL='/img/textbook/chapter_3/show_execution_order2.PNG' />

## Embedded If Statements
Let's come back to embedded if statements by reference to another example:

```yaml title="C2_03_age_eligibility.yml" showLineNumbers
# Example code to demonstrate the operation of if statements
---
mandatory: True 
question: Age eligibility
subquestion: |
  You entered your age as **${ MJFage }**

  You are
  % if MJFage_ok:
    **between 18 and 65**.
  % else:
    **not between 18 and 65**.
  % endif

  We have determined that you are
  % if MJFage_ok:
    **eligible**.
  % else:
    **not eligible**.
  %endif
buttons:
  - Exit: exit
  - Restart: restart
---
code: |
  if ( (MJFage >= 18) and
       (MJFage < 65 ) ):
    MJFage_ok = True
  else:
    MJFage_ok = False
---
question: What is your age?
fields:
  - no label: MJFage
    datatype: integer
---
```

Note that for each of our embedded if statements, we have inserted some blank lines of text. This means that the results of the if statement will be displayed on the same line as the starting text, but on separate lines to one another. 

## Operators 
Let's finish this chapter by looking at operators:

1. The `=` sign is an assignment operator. It's how you assign values to variables. make sure you do not confused `=` with `==`, which is used for equality.
2. The `+` and `-` signs are pretty self explanatory, at least for numbers. However, `+` can also be used to join strings togegther.
3. We use the `*` to multiply numbers and we use a `/` to divide numbers.
:::