---
title: How to Use Code to Implement a Flowchart
---
import * as Constants from '@site/src/constants'
import * as Components from '@site/src/components'

In this chapter, we are going to walk through how to construct a Docassemble application from a problem statement. We will first examine our problem statement, then we will construct a flowchart, and finally we will build out our application.

## The Problem Statement
We have received a problem statement from ABC Incorporated. ABC are a not-for-profit agency that help people with intellectual disabilities apply for the National Disability Insurance Scheme (NDIS). They want us to write something that would allow people on the autism spectrum to determine for themselves whether they might be eligible for NDIS funding they might be eligible for. 

ABC have provided us with the following information:
* ABC have told us that no one should be able to run this application unless they are between 7 and 65 years of age, currently reside in Australia, and are either a citizen, a permanent resident or hold a special visa category.
* ABC have said it is important to know whether the user running the application has been diagnosed with autism spectrum disorder (ASD), and wants that displayed on the final report.
* The app should ask two eligibility questions:
1. Does the user have any issues in participating in certain daily activities (*there are different levels of ASD severity*)?
2. Is the user's disability permanent?
* ABC tells us that if a user indicates they have any difficulty particpating in the activities listed in the first question, and that their disability will not improve, then they will be eligible. 

## Requirements Analysis

Based on what ABC have told us, it looks like our app should do three key things:
1. Ask the threshold question and exit the app immediately if the user does not meet the threshold.
2. Ask the user whether they have been diagnosed with ASD and store that information to print on the final screen.
3. Ask the user the eligibility questions that will determine whether the user is eligible for the NDIS or not.

We know that ABC have told us our user must have a permanent disability, and must have selected at least one of the checkboxes. If we look at the questions we must ask, we know that there are several potential question combinations given our eligibility questions:

| Difficulty Question | Permanence Question | Result |
| ---------------------------- | ----------------------- | -------- |
| Select at least one checkbox | Disability is permanent | Eligible |
| Select at least one checkbox | Disability may improve | Not Eligible |
| Select at least one checkbox | Don't know | Maybe - Refer to ABC |
| Do not select any checkboxes | Any answer | Not Eligible |

We can see from this table as well that we have three potential endpoints - **Eligible**, **Not Eligible** and **Maybe**. With these questions, and these endpoints, we can construct a flowchart.

## Constructing our Flowchart
Now, let's talk about how we can convert these instructions into a flowchart.

First, it is always a good practice to start any application with a welcome screen and/or a disclaimer screen. Remember that with your applications, you are providing *legal information*, not *legal advice*. Therefore, you should remind your user that you are not providing legal advice via your application, and if they need that legal advice they should speak to a lawyer. 

Depending on the questions you ask, you might also be collecting personal information. This means that you will need to comply with any relevant privacy law, such as the *Privacy Act 1988* (Cth). Under most privacy legislation, the usual way to seek approval to use that information is via user consent. 

For the purposes of our application, we are going to split out our welcome screen and disclaimer screen into two separate screens. The welcome screen will explain what the application does. Then the disclaimer screen will explain that the app does not provide legal advice, and that by pressing **Continue**, they agree to the terms and services provided. If the user presses **Exit**, they will be redirected out of the application. 

Second, we are going to write our threshold questions. These questions will ask the user whether they are currently between 7 and 65 years of age, whether they are an Australian resident and whether they have citizenship or a visa. We will split these out into separate question screens. If the user does not meet the threshold requirements, we will redirect them to an ineligible screen. Otherwise, they will continue to the next question.

Third, we need to ask the user whether they have been diagnosed with ASD or not. If they have been diagnosed, we will need to ask some questions about the diagnosis. This includes who performed the diagnosis, as well as what level of ASD the user was diagnosed with. If the user has not been diagnosed with autism, the application then just skips to the next set of questions.

Finally, we need to ask our questions about the difficulty that the user experiences in day to day life, and whether their disability is permanent. We will ask these as two separate questions. We will ask these questions on two separate question screens. We can see from our table above that if the user does not select any answers for their checkbox, then they will be directed to another ineligible endpoint. Therefore, we don't need to ask any more questions if the user selects none of these checkboxes. 

If they do select at least one checkbox, then they will be directed onto the permanence question. Here, we want to tell the user to contact ABC if the user is not sure whether their disability is permanent. If they are sure that their disability is permanent, then they will be directed to the eligible endpoint. Otherwise, they will be directed to the ineligible endpoint.

Using these requirements, we can see that the flowchart looks something like this:

<Components.DisplayImage imageURL='/img/textbook/chapter_3/ABC_flowchart.png' />

Each of the blue rectangles is a question screen where we ask something of the user or display something to the user. Therefore, we will implement these as separate ``question`` blocks in Docassemble. 

The yellow speech bubbles display the text that we will show to the user. We will need to implement these in the ``subquestion`` section of each question block. 

Finally, the yellow hexagons are points where our user will be directed to eligible or ineligible endpoints depending on their answers. We will need to implement these in ``code`` blocks using if statements.

Although there are multiple ways you might structure this flowchart, the principles that we used here are useful for designing your own flowchart (and then designing your own application). Specifically, your flowchart should contain enough information to identify *each* question that you ask your user.

## Implementing the Flowchart in Docassemble Code

Now that we have designed our flowchart, let's see how we can implement this in Docassemble:

```yaml title="C5_02_ABC.yml" showLineNumbers
mandatory: True
code: |
  MJFdisplay_welcome_screen
  MJFdisplay_disclaimer_screen
  
  # Threshold requirements
  if MJFage_ok and MJFis_resident and MJFis_citizen:
    # We're here because the threshold questions were met
    MJFASD_diagnosed
    
    # Ask the eligibility questions
    if MJFDQ1.any_true():
      if MJFDQ2 == 'There is no treatment to improve my impairment':
        MJFeligible_endpoint
      elif MJFDQ2 == 'My impairment may improve over time':
        MJFineligible_endpoint_2
      elif MJFDQ2 == "I don't know":
        MJFineligible_endpoint_3
      else:
        pass
    else:
      MJFineligible_endpoint_1
  else:
    MJFthreshold_not_met
---
question: Welcome
subquestion: |
  Welcome to the NDIS ASD app!
continue button field: MJFdisplay_welcome_screen
---
code: |
  MJFdisplay_disclaimer_screen = True
  force_ask('MJFdisclaimer_screen')
---
event: MJFdisclaimer_screen
question: Disclaimer
subquestion: |
  This is not legal advice
  
  bla bla bla
buttons:
  - I accept these terms: continue
  - I do not accept these terms: exit
---
# Age requirements
question: What is your age
fields:
  - no label: MJFage
    datatype: integer
    default: 33
---
# This code block works out MJFage_ok
code: |
  if 7 <= MJFage <= 65:
    MJFage_ok = True
  else:
    MJFage_ok = False
---
# Residency threshold question
question: Are you currently residing in Australia?
yesno: MJFis_resident
---
# Citizenship question
question: Citizenship
subquestion: |
  Are you either:
  
  - an Australian citizen;
  - a holder of a permanent residency visa; or
  - a holder of a Special Category Visa ('SCV')
fields:
  - no label: MJFis_citizen
    datatype: yesnoradio
    default: True
---
event: MJFthreshold_not_met
question: Ineligible
subquestion: |
  You are not eligible to run this application because you have indicated that
  you are either:
  
  - not between 7 and 65 years of age;
  - not resident in Australia; or
  - not an Australian citizen, permanent visa holder or Special Category Visa holder
  
  Some text to direct ABC website
buttons:
  - Exit: exit
  - Restart: restart
---
question: ASD Diagnosis
fields:
  - Have you been diagnosed with ASD?: MJFASD_diagnosed
    datatype: yesnoradio
  - Who diagnosed you?: MJFwho_diagnosed_you
    datatype: checkboxes
    choices:
      - Multi-disciplinary team
      - Paediatrician
      - Psychiatrist
    show if:
      variable: MJFASD_diagnosed
      is: True
  - What level was your ASD diagnosis: MJFASD_level
    datatype: radio
    choices:
      - Level 1
      - Level 2
      - Level 3
    show if:
      variable: MJFASD_diagnosed
      is: True
---
question: Do you have trouble with any of the following?
fields:
  - no label: MJFDQ1
    datatype: checkboxes
    choices:
      - I have difficulty participating in sports
      - I have difficulty performing voluntary work
      - I have difficulty travelling
      - I have trouble engaging in social activities
---
event: MJFineligible_endpoint_1
question: You are not eligible
subquestion: |
  In order to be eligible for the NDIS your disability must impair your
  daily life
buttons:
  - Exit: exit
  - Restart: restart
---
question: How permanent is your disability?
fields:
  - no label: MJFDQ2
    datatype: radio
    choices:
      - There is no treatment to improve my impairment
      - My impairment may improve over time
      - "I don't know"
---
event: MJFeligible_endpoint
question: You are eligible
subquestion: | 
  You may be eligible for to apply for the NDIS.
  
  Questions we asked|Your Answers
  ---|---
  Your age:|${MJFage}
  Your residency status|${MJFis_resident_for_display}
  Your citizenship status|${MJFis_citizen}
  %if MJFASD_diagnosed:
  ASD Diagnosis|You have been diagnosed with ASD
  Who diagnosed you|${MJFwho_diagnosed_you.true_values()}
  Level diagnosed|${MJFASD_level}
  %else:
  ASD Diagnosis|You have not been diagnosed with ASD
  %endif
  Difficulty with daily activities|${MJFDQ1.true_values()}
  Permanence of disability|${MJFDQ2}
buttons:
  - Exit: exit
  - Restart: restart
---
event: MJFineligible_endpoint_2
question: You are not eligible
subquestion: |
  You are not eligible as your disability is not permanent
buttons:
  - Exit: exit
  - Restart: restart
---
event: MJFineligible_endpoint_3
question: You may not be eligible
subquestion: |
  You would only be eligible if your disability was permanent.
  
  Contact ABC bla bla bla.
buttons:
  - Exit: exit
  - Restart: restart
---
code: |
  if MJFis_resident:
    MJFis_resident_for_display = 'You are resident in Australia'
  else:
    MJFis_resident_for_display = 'You are not an Australian resident'
---
```

That's a lot of code. What we are going to do is work out what this does, piece by piece.

## One Mandatory Code Block

So far, we have discussed how we need a mandatory block to drive the logic of our application. It is best coding practice to have only **one** mandatory ``code`` block for your application. 

Let's start on Lines 3 and 4. The call to `MJFdisplay_welcome_screen` forces Docassemble to display the continue button field `MJFdisplay_welcome_screen`. 
:::