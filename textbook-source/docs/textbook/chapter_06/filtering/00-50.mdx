---
title: Coding - Evaluate against criteria
---
import {DisplayImage} from '@site/src/components';
import {DisplayChapter} from '@site/src/components';
import {DisplayGlossaryItem} from '@site/src/components';
import * as Flowcharts from './_flowcharts';
import * as Tables from './_tables';

This part of our app is the most logically complex part.  It's going to take us some
time to wade through it.  So, grab a coffee, grab some food, grab your therapist
and let's get going!

## The parent loop
As we said in our [Introduction](00-20) the plan is to store all our decision-making code
in `process_data.yml`.  Also, in our [design](00-10#evaluate-against-service-criteria) we
worked out pretty quickly that all our decision-making is going to be based around a 
loop that iterates over `MJFservices`.  So, we may as well start with that:
```yml title="process_data.yml" showLineNumbers
---
code: |
  for a_service in MJFservices:
    # Loop body
    # Lots of work will get done here!
---
```

## The evaluation criteria
In our [design](00-10#loop-body) we also worked out that the loop body consisted of these components:
1. determine if `MJFage` fits in the age criteria;
1. determine if `MJFgender` fits in the gender criteria;
1. determine if `MJFlocation` fits in the location criteria;
1. determine if `MJFfamily` fits in the family criteria;
1. use a logical 'and' to ensure all these criteria are met;
1. add the service to a display list if the criteria are met.

Let's build out our loop body a bit more:
```yml title="process_data.yml" showLineNumbers
---
code: |
  for a_service in MJFservices:

    # Set MJFage_ok

    # Set MJFgender_ok

    # Set MJFlocation_ok

    # Set MJFfamily_ok

    # Test criteria and add to relevant services list
---
```
### `MJFage_ok`
We have [an idea](00-10#the-age-question) of how to code `MJFage_ok`.  We need to replace
the numbers in our design with the actual `min_age` and `max_age` from the service in 
`a_service`.  Our `MJFage_ok` test should look like this:
```python
MJFage_ok = a_service['min_age'] <= MJFage <= a_service['max_age']
```

### `MJFgender_ok` and `MJFfamily_ok`
In our design we worked out that both the [gender](00-10#the-gender-question)
and [family](00-10#the-family-question)  evalutaions were list membership tests.  The code
for both is in our design and is:
```python
MJFgender_ok = MJFgender in a_service['gender']
```
and
```python
MJFfamily_ok = MJFfamily in a_service['family']
```

### `MJFlocation_ok`
We concluded that [testing for locations](00-10#the-location-question) was a little more complex
than the other questions, this being because a user can select more than one location.  It follows
then that we must test each location the user selected against the location list in `a_service`
and, if any location matches, then set `MJFlocation_ok` to true.

We can use iteration to solve the multiple location issue.  However, we also have a second issue.
How do we manage a situation where one location matches but the second does not?  How can we
ensure that `MJFlocation_ok` remains `True` in this context?

We manage this `MJFlocation_ok` by setting it to `False` *before* we start the loop. As
we iterate over the locations, we change `MJFlocation_ok` to `True` if we find a  match
but if a location doesn't match we do nothing. What we're doing is starting out with
the assumption that we won't get any matches (ie: `MJFlocation_ok == False`) and,
if we find at least one match we set `MJFlocation_ok` to `True`.  It only 
takes one match to permanently set `MJFlocation_ok` to `True`.

Let's see this in code:

